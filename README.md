# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Архитектура проекта

Приложение разделено на несколько основных уровней:

- Модель (Model) — отвечает за хранение и обработку данных. Реализована через абстрактный класс Model и конкретные классы состояния.

- Представление (View) — отвечает за визуализацию и взаимодействие с пользователем.

- Контроллер / Брокер событий (EventEmitter) — обеспечивает связь между моделью и представлением через события.

Архитектура построена по принципу MVP (Model–View–Presenter). Взаимодействие между компонентами осуществляется через события и абстрактные базовые классы.


### Базовые классы


**Абстрактный класс Model**

Model - базовый абстрактный класс для всех моделей приложения. 


Конструктор: `constructor(data: Partial<T>, events: IEvents)`
Принимает часть данных модели и объект событийного брокера, реализующего интерфейс IEvents. 


Содержит метод emitChanges для уведомления об изменении данных через EventEmitter.


**Класс AppState**

AppState — основной класс для управления состоянием приложения. 
Он контролирует данные о товарах, корзине, заказах и предпросмотре товара, а также управляет ошибками формы.


Конструктор: `constructor(data: IAppState, events: IEvents)`
Принимает исходные данные состояния приложения и объект событийного брокера, реализующий интерфейс IEvents.


Содержит методы:

- toggleBasketItem(id: string): void
Переключает наличие товара в корзине: если был — удаляет, если не был — добавляет;

- setCatalog(items: IProduct[]): void
Обновляет каталог товаров и вызывает событие items:changed;

- setPreview(id: string): void
Устанавливает ID товара для предпросмотра и вызывает событие preview:changed;

- clearBasket(): void
Очищает корзину и заказ (поле order.items) и вызывает событие basket:changed;

- setOrderField(field: keyof IOrderForm, value: string): void
Устанавливает значение одного из полей формы заказа (email, phone, address). При валидной форме вызывает событие order:ready;

- validateOrder(): boolean
Валидирует форму заказа, заполняет formErrors, вызывает formErrors:change, возвращает true, если ошибок нет.


Свойства:
- catalog: Массив объектов товаров, которые отображаются в каталоге

- basket: Массив ID товаров, добавленных в корзину

- preview: ID товара, выбранного для предпросмотра

- order: Объект, содержащий информацию о заказе, включая данные клиента и список выбранных товаров

- formErrors: Ошибки формы, которые могут возникать при заполнении данных клиента.



**View<T>**

View<T> - базовый класс для всех отображений: принимает корневой DOM-элемент и настройки, содержит метод render для отображения данных, список событий и брокер событий для взаимодействия с другими частями приложения.


Конструктор: `(root: HTMLElement, settings: S): IView<T>`
Принимает клонированный шаблон или существующий элемент,a также настройки для отображения


Особенности:

- Хранит корневой DOM-элемент

- Метод render(data: T): HTMLElement для отрисовки содержимого

- Метод copy() для клонирования компонента

- Используется как базовый класс для всех визуальных компонентов.



**Класс EventEmitter**

Класс EventEmitter обеспечивает работу с событиями внутри приложения. Реализует паттерн «наблюдатель» (Observer), позволяющий организовать асинхронное взаимодействие между компонентами приложения. Он предоставляет методы для подписки на события, их эмитации и управления подписчиками.

Конструктор: без параметров.


Особенности:

- Установка (on) и удаление (off) слушателей событий

- Инициация событий с передачей данных (emit)

- Подписка на все события (onAll)

- Сброс всех подписчиков (offAll)

- Генерация коллбека для автоматической отправки события (trigger).



**Класс Api**

Api — класс, реализующий взаимодействие с серверным API. Отвечает за формирование и отправку HTTP-запросов, а также обработку ответов.


Конструктор `constructor(baseUrl: string, options: RequestInit = {})`
Принимает базовый URL и глобальные опции для всех запросов(опционально).


Особенности:

- Хранит базовый URL для всех запросов

- Настраивает общие заголовки, включая Content-Type: application/json

- Поддерживает методы GET, POST, PUT и DELETE

- Автоматически преобразовывает данные в JSON при отправке

- Метод handleResponse(response: Response): Promise<any> обрабатывает ответ сервера, преобразует его в JSON или выбрасывает ошибку при неуспешном ответе.

- Обрабатывает ответы сервера, парсит JSON и выбрасывает ошибки при неуспешных статусах.



**Класс FormErrors**

FormErrors управляет ошибками, которые возникают при заполнении формы заказа. Он хранит список ошибок для каждого поля и уведомляет пользователя о необходимости исправить данные.


Конструктор: `constructor(container: HTMLFormElement, events: IEvents)`
Принимает корневой DOM-элемент формы и объект событийного брокера для взаимодействия.


Свойства:

- email: Ошибка, если не указан email

- phone: Ошибка, если не указан телефон

- address: Ошибка, если не указан адрес.



**Класс BasketModel**

BasketModel управляет корзиной покупок. Он позволяет добавлять товары в корзину, удалять их и рассчитывать общую стоимость.


Конструктор: без параметров.


Свойства:

- items: Массив ID товаров в корзине


Методы:

- addItem: Добавляет товар в корзину

- removeItem: Удаляет товар из корзины

- getTotalPrice: Рассчитывает общую стоимость товаров в корзине.




**Класс Page**

Page управляет визуальным представлением страницы. Он отображает список с карточками товаров и количество уже добавленных товаров в корзине.


Конструктор `constructor(container: HTMLElement, events: IEvents)`
Принимает корневой HTML-элемент страницы и объект событийного брокера, реализующий интерфейс IEvents.


Свойства:

- counter — количество товаров в корзине, отображается в иконке корзины

- catalog — список карточек товаров, отображаемых в каталоге.



**Класс Modal**

Modal отвечает за отображение и управление модальным окном, которое используется для предпросмотра товара с его полным описанием или оформления заказа.


Конструктор `constructor(container: HTMLElement, events: IEvents)`
Принимает контейнер модального окна и объект событийного брокера, реализующий интерфейс IEvents.


Свойства:

- protected _closeButton: HTMLButtonElement — кнопка закрытия модального окна

- protected _content: HTMLElement — контейнер для динамически вставляемого содержимого

- protected events: IEvents — объект для работы с глобальными событиями

- protected container: HTMLElement (унаследовано от Component) — корневой DOM-элемент компонента


Сеттеры:

- set content(value: HTMLElement): void — заменяет содержимое модального окна на переданный элемент


Методы:

- open(): void — открывает модальное окно, добавляя класс modal_active и отправляя событие modal:open

- close(): void — закрывает модальное окно, очищает содержимое и отправляет событие modal:close

- render(data: IModalData): HTMLElement — отображает переданные данные, автоматически открывает модальное окно и возвращает контейнер



### Компоненты и их назначение



**Компонент ProductCard**

Отображает одну карточку товара в каталоге. Получает данные о товаре (IProduct) и отображает его изображение, название, цену и категорию.
Реагирует на клик: открывает модальное окно предпросмотра товара с полными данными о товаре.



**Компонент: ProductPreviewModal**

Отображает модальное окно с подробной информацией о товаре.
Содержит кнопки «Купить» и «Убрать»:

- При нажатии «Купить» — добавляет товар в корзину, если его там не было

- При нажатии «Убрать» — удаляет товар из корзины.


Модальное окно закрывается по нажатию на крестик или вне окна.



**Компонент: Basket**

Отображает список всех товаров, добавленных в корзину, вместе с общей стоимостью.
Реагирует на нажатие иконки корзины — открывается/закрывается модальное окно.
Позволяет убрать товары из корзины и инициировать процесс оформления заказа.



**Компонент: OrderFormStep1**

Первый шаг оформления заказа. Содержит поля:

- выбор способа оплаты (наличные или онлайн)

- поле ввода адреса доставки.

Если адрес не введён — появляется сообщение об ошибке. Кнопка перехода на следующий шаг становится активной только при заполнении всех полей.



**Компонент: OrderFormStep2**

Второй шаг оформления заказа. Содержит поля:

- email

- телефон.

Если не заполнено хотя бы одно поле, появляется сообщение об ошибке.


При нажатии на кнопку «Оплатить»:
если все данные корректны — выводится сообщение об успешной оплате,
корзина очищается.